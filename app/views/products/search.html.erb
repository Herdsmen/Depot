<div id="storeindex">
	<h1>Search Result</h1>
	
	Sort By:
	<%= sort_link @search, :title %> | 
	<%= sort_link @search, :price %>
	
	<div id="entries">
		<script type="text/javascript">var integer = /^[0-9]*[1-9][0-9]*$/;</script>
		<% @products.each do |product| %>
			<div class="entry" >
				<%= image_tag(product.image_url) %>
				<h3><%= link_to product.title, :controller => "products", :action => "show", :id => product.id %></h3>
				<p><%= truncate(strip_tags(product.description), :length => 300) %></p>
				<div class="price_line">
					<span class="price">
						<%= number_to_currency(product.price) %>
					</span>
					Heat:
					<span class="heat" id="<%= product.id %>">
						<%= product.heat%>
					</span>
					<%= periodically_call_remote(:update => { :success => product.id }, 
												 :url => { :action => "get_heat", :product_id => product.id }, 
												 :frequency => 30) %>
												 
					<%= form_tag(:controller=> 'line_items', :action=> 'create', :product_id => product.id, :remote =>true, :multipart => true,  :method => :post) do -%>
						<!--<input type="button" value="-" onmousedown="changeNum<%= product.id %>.DOWN()" onmouseup="changeNum<%= product.id %>.mouseUpHandle()">-->
						<%= number_field_tag :quantity, 1, :class => "quantity", :in => 1...99, :onchange => "if(!integer.test(this.value)){alert('Quantity can only be a integer！');this.value='1';}"%>
						<!--<input type="button" value="+" onmousedown="changeNum<%= product.id %>.UP()" onmouseup="changeNum<%= product.id %>.mouseUpHandle()">-->
  						<%= submit_tag 'Add to Cart', :disabled => @is_user %>
					<% end -%>
					
					<!--<%= button_to 'Add to Cart'.html_safe, line_items_path(:product_id => product),:remote=>true ,:disabled =>@is_user%>-->
					<%= button_to "collect", 
						{:controller=> "customers", :action=> "collect", :product_id => product.id},
						:disabled => @is_user %>
				</div>				
			</div>
		<% end %>
		
	</div>
</div>