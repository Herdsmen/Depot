<% if notice %>
<p id="notice"><%= notice %></p>
<% end %>

<div id="storeindex">
	<h1><%= t('.title_html')%></h1>
	<div id="entries">
		<script type="text/javascript">var integer = /^[0-9]*[1-9][0-9]*$/;</script>
		<% @products.each do |product| %>
			<div class="entry" >
				<%= link_to image_tag(product.image_url),:controller => "products", :action => "show", :id => product.id %>
				<h3><%= link_to product.title, :controller => "products", :action => "show", :id => product.id %></h3>
				<p><%= truncate(strip_tags(product.description), :length => 300) %></p>
				<div class="price_line">
					<span class="price"><%= number_to_currency(product.price) %></span>
					Heat:
					<span class="heat" id="<%= product.id %>"><%= product.heat%></span>
					<%= periodically_call_remote(:update => { :success => product.id }, 
												 :url => { :action => 'get_heat', :product_id => product.id }, 
												 :frequency => 30) %>
												 
					<script type="text/javascript">var changeNum<%= product.id %> = new classChangeNum('<%= 'quantity'+product.id.to_s %>');</script>
					<%= form_tag(:controller=> 'line_items', :action=> 'create', :product_id => product.id, :remote =>true, :multipart => true,  :method => :post) do -%>
						<input type="button" value="-" onmousedown="changeNum<%= product.id %>.DOWN()" onmouseup="changeNum<%= product.id %>.mouseUpHandle()">
						<%= number_field_tag 'quantity'+product.id.to_s, 1, :class => "quantity", :onchange => "if(!integer.test(this.value)){alert('Quantity can only be a integer！');this.value='1';}"%>
						<input type="button" value="+" onmousedown="changeNum<%= product.id %>.UP()" onmouseup="changeNum<%= product.id %>.mouseUpHandle()">
  						<%= submit_tag t('.add'), :disabled => @is_user %>
					<% end -%>
					
					<!--<%= button_to t('.add').html_safe, line_items_path(:product_id => product),:remote=>true ,:disabled =>@is_user%>-->
					<%= button_to 'collect',{:controller=> 'customers',:action=> 'collect',:product_id => product.id},:disabled =>@is_user%>
				</div>				
			</div>
		<% end %>
		<p><%= will_paginate @products %></p>
	</div>
	<div id="recommend">
		<% rank = 1 %>
		<% @topfive.each do |product| %>
			<dl>
    			<dt><%= image_tag(product.image_url) %></dt>
    			<dd>
    				<strong><%= rank%></strong>
   		   			<div>
   		   				<h3><%= link_to product.title, :controller => "products", :action => "show", :id => product.id %></h3>
						<span class="price_line">							
							<span class="price"><%= number_to_currency(product.price) %></span>
							Heat:
							<span class="heat" ><%= product.heat%></span>
						</span>
        				<p><%= truncate(strip_tags(product.description), :length => 80) %></p>
        				<%= button_to t('.add').html_safe, line_items_path(:product_id => product),:remote=>true ,:disabled =>@is_user%>
						<%= button_to 'collect',{:controller=> 'customers',:action=> 'collect',:product_id => product.id},:disabled =>@is_user%>
      				</div>
    			</dd>
  			</dl>
  		<% rank += 1%>
		<% end %>
	</div>
</div>
